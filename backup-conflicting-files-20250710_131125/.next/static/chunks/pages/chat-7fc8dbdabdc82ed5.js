(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8180],{17722:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return t(11689)}])},11689:function(e,s,t){"use strict";t.r(s);var a=t(85893),n=t(67294),r=t(33299),l=t(11163),i=t(41863);let c=(0,t(48967).eI)("https://PROD_PROJECT_ID.supabase.co","PROD_SUPABASE_ANON_KEY_HERE");s.default=function(){var e;let{data:s,status:t}=(0,r.useSession)(),o=(0,l.useRouter)(),[d,u]=(0,n.useState)([]),[m,h]=(0,n.useState)(""),[f,x]=(0,n.useState)([]),[p,g]=(0,n.useState)("general"),[v,N]=(0,n.useState)(!0),j=(0,n.useRef)(null);(0,n.useEffect)(()=>{"unauthenticated"===t&&o.push("/auth/signin?callbackUrl=/chat")},[t,o]),(0,n.useEffect)(()=>{(async function(){try{let{data:e,error:s}=await c.from("channels").select("*").order("name");if(s)throw s;e&&x(e)}catch(e){console.error("Error fetching channels:",e),x([{id:1,name:"general",description:"General discussion"},{id:2,name:"support",description:"Customer support"},{id:3,name:"orders",description:"Order inquiries"}])}finally{N(!1)}})()},[]),(0,n.useEffect)(()=>{async function e(){try{let{data:e,error:s}=await c.from("messages").select("*, profiles(*)").eq("channel",p).order("created_at");if(s)throw s;e&&u(e)}catch(e){console.error("Error fetching messages:",e),u([{id:1,content:"Welcome to the chat!",created_at:new Date().toISOString(),profiles:{username:"System",avatar_url:"/images/avatars/system.png"}},{id:2,content:"How can we help you today?",created_at:new Date(Date.now()-3e5).toISOString(),profiles:{username:"Support",avatar_url:"/images/avatars/support.png"}}])}}p&&e()},[p]),(0,n.useEffect)(()=>{let e=c.channel("public:messages:channel=eq.".concat(p)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"channel=eq.".concat(p)},e=>{(async()=>{try{let{data:s,error:t}=await c.from("profiles").select("*").eq("id",e.new.user_id).single();if(t)throw t;let a={...e.new,profiles:s};u(e=>[...e,a])}catch(s){console.error("Error fetching profile for new message:",s),u(s=>[...s,e.new])}})()}).subscribe();return()=>{c.removeChannel(e)}},[p]),(0,n.useEffect)(()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[d]);let w=async e=>{if(e.preventDefault(),m.trim()&&(null==s?void 0:s.user))try{let{error:e}=await c.from("messages").insert([{content:m,channel:p,user_id:s.user.id}]);if(e)throw e;h("")}catch(n){var t,a;console.error("Error sending message:",n);let e={id:Date.now(),content:m,created_at:new Date().toISOString(),profiles:{username:(null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.name)||"You",avatar_url:(null==s?void 0:null===(a=s.user)||void 0===a?void 0:a.image)||"/images/avatars/default.png"}};u(s=>[...s,e]),h("")}},b=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return"loading"===t||v?(0,a.jsx)(i.Z,{title:"Chat | MDTS",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("p",{className:"ml-4",children:"Loading chat..."})]})})}):"unauthenticated"===t?(0,a.jsx)(i.Z,{title:"Chat | MDTS",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{children:"Please sign in to access the chat."})})})}):(0,a.jsx)(i.Z,{title:"Chat | MDTS",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"MDTS Support Chat"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"w-full md:w-1/4 bg-gray-100 rounded-lg p-4",children:[(0,a.jsx)("h2",{className:"font-semibold text-lg mb-4",children:"Channels"}),(0,a.jsx)("ul",{children:f.map(e=>(0,a.jsx)("li",{className:"mb-2",children:(0,a.jsxs)("button",{onClick:()=>g(e.name),className:"w-full text-left px-3 py-2 rounded ".concat(p===e.name?"bg-blue-500 text-white":"hover:bg-gray-200"),children:["# ",e.name,(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-300",children:e.description})]})},e.id))})]}),(0,a.jsxs)("div",{className:"w-full md:w-3/4 bg-white rounded-lg shadow-md flex flex-col h-[600px]",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b",children:[(0,a.jsxs)("h2",{className:"font-semibold",children:["#",p]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null===(e=f.find(e=>e.name===p))||void 0===e?void 0:e.description)||"Channel description"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[0===d.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No messages yet. Start the conversation!"})}):d.map(e=>{var s,t,n;return(0,a.jsxs)("div",{className:"mb-4 flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mr-3",children:(0,a.jsx)("img",{src:(null===(s=e.profiles)||void 0===s?void 0:s.avatar_url)||"/images/avatars/default.png",alt:(null===(t=e.profiles)||void 0===t?void 0:t.username)||"User",className:"w-10 h-10 rounded-full"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-baseline",children:[(0,a.jsx)("span",{className:"font-semibold mr-2",children:(null===(n=e.profiles)||void 0===n?void 0:n.username)||"Anonymous"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:b(e.created_at)})]}),(0,a.jsx)("p",{className:"text-gray-800",children:e.content})]})]},e.id)}),(0,a.jsx)("div",{ref:j})]}),(0,a.jsx)("div",{className:"border-t p-4",children:(0,a.jsxs)("form",{onSubmit:w,className:"flex",children:[(0,a.jsx)("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"Type your message...",className:"flex-1 border rounded-l-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-r-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Send"})]})})]})]})]})})}}},function(e){e.O(0,[1216,1863,2888,179],function(){return e(e.s=17722)}),_N_E=e.O()}]);