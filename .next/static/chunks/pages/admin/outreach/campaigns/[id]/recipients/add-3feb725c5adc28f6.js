(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3164],{51472:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/outreach/campaigns/[id]/recipients/add",function(){return n(88733)}])},88733:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return F}});var a=n(85893),i=n(67294),l=n(11163),r=n(33299),s=n(2575),o=n(13536),c=n(84653),d=n(50447),m=n(92137),p=n(13553),h=n(18804),u=n(77093),f=n(45881),x=n(64032),j=n(83254),Z=n(65900),g=n(78738),v=n(27178),C=n(50143),y=n(32644),b=n(3517),S=n(80409),w=n(55241),I=n(84945),E=n(10283),P=n(14502),k=n(61532),N=n(89308),_=n(85717);function F(){let{data:e,status:t}=(0,r.useSession)(),n=(0,l.useRouter)(),{id:F}=n.query,[T,V]=(0,i.useState)(null),[W,A]=(0,i.useState)(!0),[R,O]=(0,i.useState)(0),[D,U]=(0,i.useState)([{name:"",email:"",phone:"",platform:"",platformId:""}]),[z,B]=(0,i.useState)(null),[M,q]=(0,i.useState)([]),[J,L]=(0,i.useState)([]),[X,H]=(0,i.useState)({name:"",email:"",phone:"",platform:"",platformId:""}),[G,K]=(0,i.useState)(!1),[Q,Y]=(0,i.useState)({open:!1,message:"",severity:"info"});(0,i.useEffect)(()=>{"authenticated"===t&&F&&$()},[t,F]),(0,i.useEffect)(()=>{"unauthenticated"===t&&n.push("/signin?callbackUrl=/admin/outreach")},[t,n]);let $=async()=>{try{A(!0);let e=await fetch("/api/outreach/campaigns/".concat(F));if(!e.ok)throw Error("Failed to fetch campaign");let t=await e.json();V(t)}catch(e){console.error("Error fetching campaign:",e),el("Failed to fetch campaign details","error")}finally{A(!1)}},ee=(e,t,n)=>{let a=[...D];a[e]={...a[e],[t]:n},U(a)},et=e=>{if(1===D.length){U([{name:"",email:"",phone:"",platform:"",platformId:""}]);return}U(D.filter((t,n)=>n!==e))},en=(e,t)=>{H({...X,[e]:t})},ea=async()=>{try{let e=D.filter(e=>e.name||e.email||e.phone||e.platform&&e.platformId);if(0===e.length){el("Please add at least one recipient with valid information","error");return}if(K(!0),!(await fetch("/api/outreach/campaigns/".concat(F,"/recipients"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipients:e})})).ok)throw Error("Failed to add recipients");el("Successfully added ".concat(e.length," recipients"),"success"),U([{name:"",email:"",phone:"",platform:"",platformId:""}]),setTimeout(()=>{n.push("/admin/outreach/campaigns/".concat(F))},1500)}catch(e){console.error("Error adding recipients:",e),el("Failed to add recipients","error")}finally{K(!1)}},ei=async()=>{try{if(!z){el("Please upload a CSV file","error");return}if(!X.name&&!X.email&&!X.phone&&!(X.platform&&X.platformId)){el("Please map at least one identification field (name, email, phone, or platform with platformId)","error");return}K(!0);let e=new FileReader;e.onload=async e=>{try{let t=e.target.result.split("\\n"),a=t[0].split(",").map(e=>e.trim()),i=[];for(let e=1;e<t.length;e++){if(""===t[e].trim())continue;let n=t[e].split(",").map(e=>e.trim()),l={name:"",email:"",phone:"",platform:"",platformId:""};Object.keys(X).forEach(e=>{if(X[e]){let t=a.indexOf(X[e]);-1!==t&&(l[e]=n[t]||"")}}),(l.name||l.email||l.phone||l.platform&&l.platformId)&&i.push(l)}if(0===i.length){el("No valid recipients found in CSV file","error"),K(!1);return}if(!(await fetch("/api/outreach/campaigns/".concat(F,"/recipients"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipients:i})})).ok)throw Error("Failed to add recipients");el("Successfully added ".concat(i.length," recipients from CSV"),"success"),B(null),q([]),L([]),H({name:"",email:"",phone:"",platform:"",platformId:""});let l=document.getElementById("csv-file-input");l&&(l.value=""),setTimeout(()=>{n.push("/admin/outreach/campaigns/".concat(F))},1500)}catch(e){console.error("Error processing CSV:",e),el("Failed to process CSV file","error"),K(!1)}},e.readAsText(z)}catch(e){console.error("Error adding recipients from CSV:",e),el("Failed to add recipients from CSV","error"),K(!1)}},el=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";Y({open:!0,message:e,severity:t})};return(0,a.jsx)(s.Z,{title:T?"Add Recipients: ".concat(T.name):"Add Recipients",children:(0,a.jsxs)(o.Z,{maxWidth:"xl",children:[W?(0,a.jsx)(c.Z,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,a.jsx)(d.Z,{children:"Loading campaign..."})}):T?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{sx:{mb:4},children:(0,a.jsxs)(m.Z,{container:!0,spacing:2,alignItems:"center",children:[(0,a.jsx)(m.Z,{item:!0,children:(0,a.jsx)(p.Z,{onClick:()=>n.push("/admin/outreach/campaigns/".concat(F)),children:(0,a.jsx)(P.Z,{})})}),(0,a.jsxs)(m.Z,{item:!0,xs:!0,children:[(0,a.jsx)(d.Z,{variant:"h4",component:"h1",children:"Add Recipients"}),(0,a.jsxs)(d.Z,{variant:"subtitle1",color:"text.secondary",children:["Campaign: ",T.name]})]})]})}),(0,a.jsxs)(c.Z,{sx:{mb:4},children:[(0,a.jsxs)(h.Z,{value:R,onChange:(e,t)=>{O(t)},children:[(0,a.jsx)(u.Z,{label:"Manual Entry"}),(0,a.jsx)(u.Z,{label:"CSV Upload"})]}),(0,a.jsx)(f.Z,{}),0===R&&(0,a.jsxs)(c.Z,{sx:{mt:3},children:[(0,a.jsx)(x.Z,{severity:"info",sx:{mb:3},children:"Add recipients manually by filling in their details. At least one of name, email, phone, or platform with platform ID is required."}),(0,a.jsx)(j.Z,{sx:{p:3,mb:3},children:D.map((e,t)=>(0,a.jsxs)(m.Z,{container:!0,spacing:2,sx:{mb:t<D.length-1?3:0},children:[(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(Z.Z,{fullWidth:!0,label:"Name",value:e.name,onChange:e=>ee(t,"name",e.target.value)})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(Z.Z,{fullWidth:!0,label:"Email",type:"email",value:e.email,onChange:e=>ee(t,"email",e.target.value)})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:2,children:(0,a.jsx)(Z.Z,{fullWidth:!0,label:"Phone",value:e.phone,onChange:e=>ee(t,"phone",e.target.value)})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:2,children:(0,a.jsx)(Z.Z,{fullWidth:!0,label:"Platform",value:e.platform,onChange:e=>ee(t,"platform",e.target.value),helperText:"e.g. linkedin, facebook"})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:2,children:(0,a.jsx)(Z.Z,{fullWidth:!0,label:"Platform ID",value:e.platformId,onChange:e=>ee(t,"platformId",e.target.value)})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:1,sx:{display:"flex",alignItems:"center"},children:(0,a.jsx)(p.Z,{color:"error",onClick:()=>et(t),"aria-label":"Remove recipient",children:(0,a.jsx)(k.Z,{})})}),t<D.length-1&&(0,a.jsx)(m.Z,{item:!0,xs:12,children:(0,a.jsx)(f.Z,{})})]},t))}),(0,a.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,a.jsx)(g.Z,{variant:"outlined",startIcon:(0,a.jsx)(N.Z,{}),onClick:()=>{U([...D,{name:"",email:"",phone:"",platform:"",platformId:""}])},children:"Add Another Recipient"}),(0,a.jsx)(g.Z,{variant:"contained",color:"primary",onClick:ea,disabled:G,children:G?(0,a.jsx)(v.Z,{size:24}):"Add Recipients"})]})]}),1===R&&(0,a.jsxs)(c.Z,{sx:{mt:3},children:[(0,a.jsx)(x.Z,{severity:"info",sx:{mb:3},children:"Upload a CSV file with recipient information. The first row should contain headers."}),(0,a.jsxs)(j.Z,{sx:{p:3,mb:3},children:[(0,a.jsxs)(c.Z,{sx:{mb:3},children:[(0,a.jsxs)(g.Z,{variant:"outlined",component:"label",startIcon:(0,a.jsx)(_.Z,{}),children:["Upload CSV File",(0,a.jsx)("input",{id:"csv-file-input",type:"file",accept:".csv",hidden:!0,onChange:e=>{let t=e.target.files[0];if(!t)return;B(t);let n=new FileReader;n.onload=e=>{let t=e.target.result.split("\\n");if(t.length<2){el("CSV file must contain at least a header row and one data row","error");return}let n=t[0].split(",").map(e=>e.trim());L(n);let a={};n.forEach(e=>{let t=e.toLowerCase();t.includes("name")&&(a.name=e),t.includes("email")&&(a.email=e),t.includes("phone")&&(a.phone=e),t.includes("platform")&&(a.platform=e),(t.includes("platform_id")||t.includes("platformid"))&&(a.platformId=e)}),H(a);let i=[];for(let e=1;e<Math.min(t.length,6);e++){if(""===t[e].trim())continue;let a=t[e].split(",").map(e=>e.trim()),l={};n.forEach((e,t)=>{l[e]=a[t]||""}),i.push(l)}q(i)},n.readAsText(t)}})]}),z&&(0,a.jsxs)(d.Z,{variant:"body2",sx:{mt:1},children:["Selected file: ",z.name]})]}),J.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{variant:"h6",gutterBottom:!0,children:"Map CSV Columns"}),(0,a.jsxs)(m.Z,{container:!0,spacing:2,sx:{mb:3},children:[(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsxs)(Z.Z,{fullWidth:!0,select:!0,label:"Name Column",value:X.name,onChange:e=>en("name",e.target.value),SelectProps:{native:!0},children:[(0,a.jsx)("option",{value:"",children:"Not mapped"}),J.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsxs)(Z.Z,{fullWidth:!0,select:!0,label:"Email Column",value:X.email,onChange:e=>en("email",e.target.value),SelectProps:{native:!0},children:[(0,a.jsx)("option",{value:"",children:"Not mapped"}),J.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsxs)(Z.Z,{fullWidth:!0,select:!0,label:"Phone Column",value:X.phone,onChange:e=>en("phone",e.target.value),SelectProps:{native:!0},children:[(0,a.jsx)("option",{value:"",children:"Not mapped"}),J.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsxs)(Z.Z,{fullWidth:!0,select:!0,label:"Platform Column",value:X.platform,onChange:e=>en("platform",e.target.value),SelectProps:{native:!0},children:[(0,a.jsx)("option",{value:"",children:"Not mapped"}),J.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),(0,a.jsx)(m.Z,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsxs)(Z.Z,{fullWidth:!0,select:!0,label:"Platform ID Column",value:X.platformId,onChange:e=>en("platformId",e.target.value),SelectProps:{native:!0},children:[(0,a.jsx)("option",{value:"",children:"Not mapped"}),J.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})})]}),(0,a.jsx)(d.Z,{variant:"h6",gutterBottom:!0,children:"Preview"}),(0,a.jsx)(C.Z,{component:j.Z,sx:{mb:3},children:(0,a.jsxs)(y.Z,{size:"small",children:[(0,a.jsx)(b.Z,{children:(0,a.jsx)(S.Z,{children:J.map(e=>(0,a.jsx)(w.Z,{children:e},e))})}),(0,a.jsx)(I.Z,{children:M.map((e,t)=>(0,a.jsx)(S.Z,{children:J.map(t=>(0,a.jsx)(w.Z,{children:e[t]},t))},t))})]})}),(0,a.jsx)(c.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,a.jsx)(g.Z,{variant:"contained",color:"primary",onClick:ei,disabled:G,children:G?(0,a.jsx)(v.Z,{size:24}):"Import Recipients"})})]})]})]})]})]}):(0,a.jsx)(c.Z,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,a.jsx)(d.Z,{children:"Campaign not found"})}),(0,a.jsx)(E.Z,{open:Q.open,autoHideDuration:6e3,onClose:()=>{Y({...Q,open:!1})},message:Q.message,severity:Q.severity})]})})}}},function(e){e.O(0,[1216,2575,2888,179],function(){return e(e.s=51472)}),_N_E=e.O()}]);